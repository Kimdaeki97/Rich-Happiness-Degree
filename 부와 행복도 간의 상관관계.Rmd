---
title: "부와 행복 간의 상관관계"
author: "8조_김대기 김효진 신송아 신재식"
output:  html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


####1. 분석(연구)의 필요성
행복은 반드시 ‘삶의 질’ 또는 ‘소득(생활)수준’과 관련이 있는 것이 아니며, 사회에 따라 행복기준이 달리 나타나는 것으로 보고된 바 있다.[^1] 하지만 '돈 많은게 최고의 행복이다’라는 말은 사람들 누구나 공감하는 말일 것이다. 그래서 우리는 이러한 연구와 사회통념 중 어느 것이 사회에 더 적합한지 알아보고자 한다. 이에 다양한 방면으로 분석을 진행 하기 위해 먼저 재정상태와 연령, 종합행복지수, 재정상태에 대한 행복지수를 통해 다양한 가설들을 세워 분석해보기로 하였다. 그렇게 나온 분석할 가설은 아래와 같다.           
**(가설1) 재정수준이 높은 지역일수록 평균연령이 높을 것이다 **     
**(가설2) 재정상태에 대한 행복지수가 높은 지역은 평균연령도 높을 것이다.**    
**(가설3) 재정수준이 높은 지역일수록 종합행복지수가 높을 것이다**     
**(가설4-1) 재정수준이 높을 수록 재정상태에 따른 행복지수도 높을 것이다.**         
**(가설4-2) 재정수준이 높은 사람들이 사는 지역과 재정상태에 대한 행복지수가 높은 사람이 사는 지역은 비슷할 것이다.**
   
우리는 이를 차례로 분석하여 각각 항목의 상관관계를 알아보고 유의한 결과를 도출해내고자 한다.

---
[^1]: 출처: KIHASA 한국보건연구. 




####2. 데이터 선정
분석에 필요한 데이터로 구별 지방 재정의 계획수립 및 운용 현황을 파악하기 위해 작성된 서울 특별시 세무과의 자료인 **2016 지방세 징수 데이터**와 지방행정기관의 제반 행정사항의 기초자료로 활용하는 것을 목적으로 서울특별시 통계데이터담당관「서울서베이(도시정책지표조사)」에 의해 작성된 **2016 평균연령 데이터**, 그리고 서울시민의 주관적인 행복정도를 알기 위해 작성된 서울특별시 통계데이터담당관「서울서베이(도시정책지표조사)」에 의해 작성된 **2016 행복지수 데이터**를 사용하였다.

재산세 중 구세를 뽑아 분석에 사용한 이유는 구별로 분석을 시행하기 때문에 시세보다 좀 더 정확한 세금추이를 파악할 수 있기때문이다. 재산은 서울시 각 자치구의 지방세 세목별·세입 단위별(시세·구세) 징수들이 있는 데이터에서 재산세 데이터를 사용했다.
평균연령의 계산 방법은 ‘평균연령 = {각 세 연령별 인구×(연령+0.5)}의 총합을 총인구로 나눈 값(외국인 제외)’으로 계산하였다.
행복지수에 관한 데이터의 경우, 자신의 주관적인 행복점수를 0부터 10까지 표시한 문항으로 측정하였으며 그 중에서도 행복지수와 재정상태수에 따른 행복지수를 추출해 분석하였다. 종합행복지수는 (건강상태에 따른 행복지수+재정상태에 따른 행복지수+관계상태에 따른 행복지수+가정생활에 따른 행복지수+사회생활에 따른 행복지수)를 모두 더하여 5로 나눈 값이다.

####3. 데이터 분석
#####3-1. 데이터 전처리(데이터 취합을 위한 작업)
```{r, warning=FALSE}
library(readxl)      #엑셀파일 불러들이기위한 패키지 장착

#분석할 데이터(엑셀파일) 불러오기
df_analysis <- read_excel("2016 자치구별 연령별 인구.xls") 
df_analysis_1 <- read_excel("2016지방세징수.xls")
df_analysis_2 <- read_excel("2016행복지수.xls")
df_analysis_3 <- read_excel("2016평균연령(구별).xls")

#데이터 복사본 만들기
df_analysis_new <- df_analysis
df_analysis_1_new <- df_analysis_1
df_analysis_2_new <- df_analysis_2
df_analysis_3_new <- df_analysis_3
```
```{r, message=FALSE, warning=FALSE}
library(dplyr)                             #dplyr패키지 장착 

#필요한 변수만 추출
df_analysis_new <- df_analysis_new %>%  
  filter(`구분__1` != "남자") %>%       
  filter(`구분__1` != "여자") %>% 
  filter(`구분` != "합계") %>%      
  select(-`구분__1`)                  

df_analysis_1_new <- df_analysis_1_new %>%  
  filter(`자치구별` != "서울시") %>%      
  filter(`자치구별` != "본청") %>% 
  filter(`자치구별` !="자치구별") %>%  
  select(`자치구별`,`보통세`)          

#변수명 바꾸기_1
df_analysis_1_new <- rename(df_analysis_1_new,  `구분` = `자치구별`)
df_analysis_1_new <- rename(df_analysis_1_new,  `취득세` = `보통세`)

#필요한 변수만 추출하기
df_analysis_2_new <- df_analysis_2_new %>%  
  filter(`대분류` != "대분류") %>%    
  filter(`대분류` != "서울시") %>%    
  filter(`대분류` != "성별") %>%       
  filter(`대분류` != "연령별") %>% 
  filter(`대분류` != "학력별") %>% 
  filter(`대분류` != "소득별") %>% 
  filter(`대분류` != "혼인상태별") %>% 
  filter(`대분류` != "지역대분류") %>% 
  select(-`기간`, -`대분류`)          

#변수명 바꾸기_2
df_analysis_2_new <- rename(df_analysis_2_new,  `행복지수(건강상태)` = `항목별 행복지수`)
df_analysis_2_new <- rename(df_analysis_2_new,  `행복지수(재정상태)` = `항목별 행복지수__1`)
df_analysis_2_new <- rename(df_analysis_2_new,  `행복지수(관계상태)` = `항목별 행복지수__2`)
df_analysis_2_new <- rename(df_analysis_2_new,  `행복지수(가정생활)` = `항목별 행복지수__3`)
df_analysis_2_new <- rename(df_analysis_2_new,  `행복지수(사회생활)` = `항목별 행복지수__4`)
df_analysis_2_new <- rename(df_analysis_2_new,  `구분` = `분류`)

#필요한 변수만 추출하기
df_analysis_3_new <- df_analysis_3_new %>% 
  filter(`지역` != "합계") %>%        
  select(-`기간`,-`남자`,-`여자`)     

#변수명 바꾸기_3
df_analysis_3_new <- rename(df_analysis_3_new,  `구분` = `지역`)

#데이터 합치기
df_a <- left_join(df_analysis_new, df_analysis_1_new, by = "구분")
df_b <- left_join(df_analysis_2_new, df_analysis_3_new, by = "구분") 
df_total <- left_join(df_a, df_b, by = "구분") 

tax <- read_excel("2016지방세징수.xls")
tax<-tax %>% filter(`기간` != '기간' & `자치구별` != '서울시' & `자치구별` != '본청') %>% select(`보통세__11`)
df_total <- cbind(df_total, tax)
df_total<-rename(df_total, `재산세`=`보통세__11`)
```

#####3-2. 데이터 파악하기 & 클린징
```{r echo=TRUE, warning=FALSE}
colSums(is.na(df_total)) #결측치 확인 
```
```{r, echo=TRUE, warning=FALSE}
#데이터 파악하기
str(df_total)  #24열부터 32열까지 수치형이 아닌 문자형으로 인식 
```

```{r}
#데이터 클린징
df_total[, 24:32] <- sapply(df_total[, 24:32], function(`행복지수(재정상태)`){as.numeric(as.character(`행복지수(재정상태)`))})

summary(df_total$`행복지수(재정상태)`)   #문자형을 수치형으로 변환 
```


#####3-3. 데이터분석
**(가설1) 재정수준이 높은 지역일수록 평균연령이 높을 것이다**

```{r}
cor.test(df_total$`재산세`, df_total$`전체평균연령`)  #지방소득세와 평균연령의 상관관계 분석
```

p-value값이 0.01599으로 0.05보다 작기 때문에 두 변수는 통계적으로 유의미하다고 볼 수 있으며 상관계수는은 -0.476683으로 음의 상관관계를 나타낸다. 따라서 우리가 세운 가설과 달리 대체적으로 재정상태가 높은 지역일수록 평균연령이 낮다는 사실을 알 수 있었다.

```{r}
library(ggplot2)
ggplot(data = df_total, aes(x = `재산세`, y = `전체평균연령`)) + 
  geom_point(shape=19, size=2, colour = 'red') + 
  ggtitle('재산세와 평균연령의 관계') +
  stat_smooth(method=lm, level=0.95) +
  geom_text(aes(label = `구분`, size = 1, vjust = -1, hjust = 0))
```

```{r}
df_total %>% arrange(desc(`재산세`)) %>% 
  select(`구분`) %>% 
  head(3)
df_total %>% arrange(`전체평균연령`) %>% 
  select(`구분`) %>% 
  head(3)
```
재산세를 가장 많이 거둬드린 세 지역은 강남구, 서초구, 송파구였고 전체평균연령이 가장 낮은 세 지역 서초구, 강남구, 양천구임을 알 수 있다.













**(가설2) 재정상태에 대한 행복지수가 높은 지역은 평균연령도 높을 것이다.**
```{r, echo=TRUE, warning=FALSE}
cor.test(df_total$`행복지수(재정상태)`, df_total$`전체평균연령`) #재정상태에 따른 행복지수와 전체평균연령 상관분석  
```
p-value값이 0.0006438으로 0.05보다 작기 때문에 재정상태에 따른 행복지수와 평균연령 사이의 상관관계는 통계적으로 유의미하다고 볼 수 있으며 상관계수는은 -0.6353347으로 음의 상관관계를 나타낸다. 따라서 서로 반비례관계라는 사실을 알 수 있다.

```{r}
library(ggplot2)
ggplot(data = df_total, aes(x = `행복지수(재정상태)`, y = `전체평균연령`))+
  geom_point(shape=19, size = 2, colour = "red")+
  xlim(5.95, 6.6)+
  ylim(39, 45)+
  ggtitle( "<행복지수(재정상태)와 평균연령의 상관관계>")+
  stat_smooth(method=lm, se =FALSE)+ 
  geom_text(aes(label = `구분`, size = 1, vjust = -1, hjust = 0))

```
```{r}
a <- df_total %>% arrange(desc(`행복지수(재정상태)`)) %>% 
  select(`구분`) %>% 
  head(3)
a
b <-df_total %>% arrange(`전체평균연령`) %>% 
  select(`구분`) %>% 
  head(3)
b
```

그래프 결과, 재정상태에 따른 행복지수가 높을수록 평균연령 낮다는 것을 일 수 있다. 
행복지수가 높은 3개의 지역은 서초구, 관악구, 강남구이고
평균연령 낮은 3개의 지역은 서초구, 강남구, 양천구로 나타났다.
둘의 결과값에 따라 나타나는 구가 거의 일치함을 알 수 있다.






**(가설3) 재정수준이 높은 지역일수록 종합행복지수가 높을 것이다.**
돈 많은게 최고의 행복이다'라는 말은 사람들 누구나 공감하는 말일 것이다. 그렇다면 과연 부자들은 다 행복할까? 돈을 많이 벌면 누구나 다 행복할까? 라는 말들이 실제로 그런지 알아보고자 한다.
```{r}
moneyhappy <- df_total %>% select(`구분`,`재산세`,`종합 행복지수`) #필요한 데이터 추출 
moneyhappy <- rename(moneyhappy, city = `구분`)                    #선택한 변수들을 작업하기 편하게 변수명 변경
moneyhappy <- rename(moneyhappy, money = `재산세`)
moneyhappy <- rename(moneyhappy, happy = `종합 행복지수`)
```
```{r}
cor.test(moneyhappy$money, moneyhappy$happy)  #재산세와 종합행복지수 사이의 상관분석   
```
p-value가 0.1047으로 0.05 미만이므로 재정상태에 따른 행복지수와 평균연령 사이의 관계가 통계적으로 유의미하지 않다고 볼 수 있다.


```{r, message=FALSE, warning=FALSE}
ggplot(data = moneyhappy, aes(x = money, y = happy)) + 
  geom_point() +
  geom_text(aes(label=city, size=0, vjust=1, hjust=0))+
   ggtitle("서울시별 재산에 따른 종합 행복지수")+
  stat_smooth(method=lm, level=0.95)
```
하지만, 그래프 결과 일부 극단치들을 제외하고 봤을 때 재산세가 높을수록 행복지수가 높아지는 것을 볼 수 있다.
따라서 재산이 많을수록 행복지수가 높게 나온다는 것을 데이터를 통해 증명할 수 있다.

 


**(가설4-1) 재정수준이 높을 수록 재정상태에 따른 행복지수도 높을 것이다.**         
**(가설4-2) 재정수준이 높은 사람들이 사는 지역과 재정상태에 대한 행복지수가 높은 사람이 사는 지역은 비슷할 것이다.**        
앞에서 나타난 분석을 통해 대체적으로 재정상태가 좋을수록 행복지수가 높다는 점을 알 수 있었다. 그러면 돈이 많아도 행복하지 않다는 사람들의 말은 틀린말일까라는 의문과 함께 재정상태가 좋으면 진정으로 재정상태에 따른 행복지수가 높을까라는 생각이 들어 분석을 하게 되었다. 그와 함께 재정수준이 높은 사람들과 재정상태에 대한 행복지수가 높은 사람들은 서울시 어디 지역에 많이 분포해 살고 있을까 궁금증이 들어 분석을 실시하게 되었다.

```{r}
happiness1<- df_total %>% select(`구분`, `행복지수(재정상태)`, `재산세`)    #필요한 데이터 추출 
```

```{r}
cor.test(happiness1$`행복지수(재정상태)`, happiness1$`재산세`)       #재산세와 재정상태에 따른 행복지수의 상관관계 분석
```
p-value값이 0.0105으로 0.05보다 작기 때문에 두 변수는 통계적으로 유의미하다고 볼 수 있으며 상관계수는 0.5023463으로 양의 상관관계를 나타낸다. 따라서 대체로 재정수준이 높을 수록 재정상태에 따른 행복지수도 높다는 가설이 검증되었다.

```{r}
ggplot(data=happiness1, aes(x=`재산세`, y=`행복지수(재정상태)`))+
  geom_point(shape=19, size = 2, colour = "red")+
  ggtitle("재정수준과 재정상태에 따른 행복지수 사이의 관계(95% 유의수준)")+
  stat_smooth(method=lm, level=0.95)+ 
  geom_text(aes(label = `구분`, size = 0, vjust = 1, hjust = 0))
```
그래프를 보면 강남구, 송파구, 서초구가 재정상태와, 재정상태에 대한 행복지수가 월등히 높은 것을 볼 수 있다. 따라서 재정상태가 좋을 수록 그에 따른 행복지수도 높다는 사실이 드러났다.



```{r warning=FALSE}
ggplot(data=happiness1, aes(x=reorder(`행복지수(재정상태)`, -`재산세`), y=`재산세`))+ geom_col()+
  geom_point(shape=19, size = 2, colour = "red")+
  geom_text(aes(label = `구분`, size = 0, vjust = 1, hjust = 0))

```

재산세와 재정상태에 따른 행복지수가 높은 지역을 표로 나타내었더니 둘 다 강남구, 서초구, 송파구 순으로 월등히 높게 나타난다. 재산세가 가장적은 강북구와 재산세가 가장 많은 강남구의 경우에는 4배 이상 재산세의 차이가 난다.


#### 4.결론   
(가설1) 재정수준이 높은 지역일수록 평균연령이 높을 것이다. ->  0.01599 p-value 값으로 유의미하며 반비례를 그리는 그래프로 **가설 기각**        
(가설2) 재정상태에 대한 행복지수가 높은 지역은 평균연령도 높을 것이다. -> 0.0006438 p-value 값으로 유의미하며 반비례를 그리는 그래프로 **가설 기각**         
(가설3) 재정수준이 높은 지역일수록 종합행복지수가 높을 것이다. ->  0.1047 p-value 값으로 유의미하지 않다.
(가설4-1)재정수준이 높을 수록 재정상태에 따른 행복지수도 높을 것이다-> 0.0105 p-value 값으로 유의미하며 정비례를 그리는 그래프로 **가설 채택**        
(가설4-2)재정수준이 높은 사람들이 사는 지역과 재정상태에 대한 행복지수가 높은 사람이 사는 지역은 비슷할 것이다.-> 강남구, 서초구, 송파구 세 지역이 재산세와 재정상태에 따른 행복지수가 모두 높은 것으로 보아 **가설 채택**        




#### 5.논의
한계점          
1) 소득이 많더라도 탈세의 가능성이 있을 수 있기 때문에 지방소득세와 소득을 동일시 하는 것은 한계가 있다.     
2) 시간이 지남에 따라 달라지는 시계열자료가 아닌 횡단면 자료를 사용하여 2016년 서울시로 한정지었기 때문에 일반화하기 어렵다.      
3) 소득과 연령이 아닌 각 구별 재산세와 평균연령을 변수로 사용했기 때문에 결과가 정확하지 않을 수 있다.      
4) 행복지수의 경우 구 사이의 행복지수의 차이가 크게 두드러지지 않는다.        
5) 그래프에서 보여지는 몇몇 극단치 값들에 대해서 논리적으로 설명할 방법이 부족하다.      
6) (가설3)이 유의미하지 않다고 나왔기 때문에 다음 분석에 사용하지 못하였다.       
7) (가설1)에서 평균연령을 사용한 것은 정확도가 떨어진다.      

추후분석방향      
1) 각 자치구별로 1인당 평균 소득 자료를 구해 소득과 행복지수와의 상관관계를 분석하는 등 다양한 자료들을 분석하여 새로운 결론을 도출해 내면 좋을 것이다.       
2) 극단치들이 왜 그렇게 나왔는지 설명할 수있는 분석을 하면 좋을 것이다.       
3) 평균연령뿐만 아니라 연령의 중간값을 사용하여 분석한다면 분석의 정확도를 높일 수 있을 것이다.      
4) 2016년도 뿐만 아니라 과거의 데이터를 수집하여 시계열자료로 분석을 한다면 서울시 내의 행복지수 변화 추이 또한 알 수 있을 것이다.         
